<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>운명의 왕자님 찾기 - NCT WISH</title>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Pretendard:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        /* 폰트 설정 */
        @font-face {
            font-family: 'RoyalTitle';
            src: url('./fonts/HeirofLightRegular.ttf') format('truetype');
            font-weight: normal; font-style: normal;
        }
        @font-face {
            font-family: 'CleanBody';
            src: url('./fonts/BookkMyungjo_Light.ttf') format('truetype');
        }
        @font-face {
            font-family: 'LetterHand';
            src: url('./fonts/GabiaMaeumgyeol.ttf') format('truetype');
        }

:root {
    /* 기존 색상보다 더 고급스러운 톤으로 변경 */
    --bg-color: #0f0c1b; /* 아주 깊은 보랏빛 네이비 */
    --main-gold: #ffd700; /* 쨍한 금색보다는 리얼 골드 */
    --sub-gold: #c5a059; /* 앤티크 골드 */
    --text-color: #f4f4f4;
    --glass-bg: rgba(20, 20, 30, 0.85); /* 반투명한 유리 느낌 */
}

        * { margin: 0; padding: 0; box-sizing: border-box; cursor: default; }
        
body {
    background-color: var(--bg-color);
    /* 중앙에서 퍼지는 신비로운 빛 효과 */
    background: radial-gradient(circle at 50% 20%, #2a2342 0%, #0f0c1b 80%);
    color: var(--text-color);
    font-family: 'CleanBody', serif;
    display: flex;
    justify-content: center;
    min-height: 100vh;
    overflow-x: hidden;
    font-size: 14px;
    
    /* [NEW] 전체 화면 테두리 (액자 효과) */
    border: 15px solid #0f0c1b; 
    box-shadow: inset 0 0 50px rgba(0,0,0,0.8); 
}

        /* 화면 전체에 얇은 금색 테두리 추가 (가상 요소) */
body::before {
    content: "";
    position: fixed;
    top: 10px; bottom: 10px; left: 10px; right: 10px;
    border: 1px solid rgba(197, 160, 89, 0.3);
    pointer-events: none;
    z-index: 999;
}

        .container {
            width: 100%;
            max-width: 480px;
            padding: 20px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* 별가루 효과 */
        .sparkle {
            position: absolute;
            width: 4px; height: 4px;
            background-color: var(--main-gold);
            border-radius: 50%;
            pointer-events: none;
            animation: fall 1s linear forwards;
            box-shadow: 0 0 5px var(--main-gold);
            z-index: 9999;
        }
        @keyframes fall {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(30px) scale(0.5); }
        }

        /* 로고 애니메이션 */
        #main-logo {
            position: absolute;
            z-index: 100;
            transition: all 1.2s cubic-bezier(0.25, 1, 0.5, 1);
            opacity: 0;
            pointer-events: none;
        }
        #main-logo.center {
            top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 70%; max-width: 300px; opacity: 1;
        }
        #main-logo.top {
            top: 30px; left: 50%; transform: translate(-50%, 0);
            width: 45%; max-width: 200px; opacity: 1;
        }

        .content-with-logo { padding-top: 160px; }
        .fade-in { animation: fadeIn 1s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        section { display: none; width: 100%; text-align: center; }
        section.active { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; }

        .intro-img {
            width: 100%; max-width: 450px; height: auto;
            border-radius: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            margin-bottom: 30px; cursor: pointer;
            animation: fadeInUp 1.5s ease-out;
        }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        input[type="text"] {
            background: transparent; border: none; border-bottom: 2px solid var(--sub-gold);
            color: white; font-size: 1.3rem; text-align: center; padding: 10px;
            margin: 20px 0; font-family: 'Gowun Batang', serif; width: 80%;
        }
        input:focus { outline: none; border-bottom-color: var(--main-gold); }

.btn-gold {
    font-family: 'RoyalTitle', serif;
    /* 그라데이션으로 금속 질감 표현 */
    background: linear-gradient(180deg, #fbe69e 0%, #c5a059 100%);
    color: #3b2e1e; /* 짙은 갈색 텍스트 */
    border: 1px solid #fff; /* 흰색 얇은 테두리로 반사광 표현 */
    padding: 15px 50px;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: bold;
    cursor: pointer;
    margin-top: 25px;
    
    /* 그림자로 입체감 극대화 */
    box-shadow: 
        0 5px 15px rgba(0,0,0,0.5),
        0 0 20px rgba(251, 230, 158, 0.4); /* 금색 빛 번짐 */
    transition: transform 0.2s, box-shadow 0.2s;
}

.btn-gold:hover {
    transform: scale(1.05) translateY(-2px);
    box-shadow: 
        0 10px 20px rgba(0,0,0,0.6),
        0 0 30px rgba(251, 230, 158, 0.6);
}

        .progress-bar { width: 100%; height: 4px; background: rgba(255,255,255,0.1); margin-bottom: 30px; border-radius: 2px; }
        .progress-fill { height: 100%; background: var(--main-gold); width: 0%; transition: width 0.3s ease; }
        
        .question-text { 
            font-family: 'CleanBody', serif; 
            font-size: 1.25rem; 
            font-weight: bold; 
            
            /* [수정] 간격을 25px -> 50px로 늘림 */
            margin-bottom: 50px; 
            
            line-height: 1.5; 
            min-height: 70px;
            
            /* (기존 폰트 효과 유지) */
            background: linear-gradient(to bottom, #fff 0%, #f1e5ac 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
.choice-btn {
    width: 100%;
    background: rgba(255, 255, 255, 0.05); /* 아주 옅은 배경 */
    border: 1px solid rgba(197, 160, 89, 0.4); /* 얇은 금색 선 */
    border-left: 4px solid var(--sub-gold); /* 왼쪽만 굵게 포인트 */
    color: #e0e0e0;
    padding: 20px;
    margin-bottom: 15px;
    border-radius: 2px; /* 각지게 */
    cursor: pointer;
    font-family: 'CleanBody', serif;
    font-size: 1rem;
    transition: all 0.3s;
    text-align: left;
    line-height: 1.5;
}

.choice-btn:hover {
    background: rgba(197, 160, 89, 0.15);
    border-color: var(--main-gold);
    padding-left: 25px; /* 살짝 오른쪽으로 이동하는 효과 */
    box-shadow: 0 0 15px rgba(197, 160, 89, 0.2);
}
        .result-card {
    background: var(--glass-bg); /* 어두운 반투명 배경 */
    border: 2px solid var(--sub-gold); /* 금색 테두리 */
    box-shadow: 
        0 0 15px rgba(197, 160, 89, 0.2), /* 금색 은은한 광 */
        inset 0 0 20px rgba(0,0,0,0.5); /* 안쪽 그림자 */
    border-radius: 5px; /* 둥근 모서리보다는 살짝 각진 게 더 클래식함 */
    padding: 30px 20px;
    position: relative;
}

        .result-card::after {
    content: "❖"; /* 마름모 문양 */
    position: absolute;
    top: -14px; left: 50%; transform: translateX(-50%);
    background: var(--bg-color);
    padding: 0 10px;
    color: var(--sub-gold);
    font-size: 1.2rem;
}
        
        .result-img { width: 100%; max-width: 280px; border-radius: 10px; margin: 15px 0; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .result-title { color: var(--main-gold); font-size: 1.3rem; margin-bottom: 8px; }
        .result-name {
    /* 텍스트에 금색 그라데이션 적용 (webkit 브라우저용) */
    background: linear-gradient(to bottom, #fff 0%, #f1e5ac 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    
    /* 텍스트 그림자 */
    text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}
        .result-quote {
    color: var(--sub-gold);
    border-top: 1px solid rgba(197, 160, 89, 0.5);
    border-bottom: 1px solid rgba(197, 160, 89, 0.5);
    padding: 15px 0;
    margin: 20px 0;
    font-family: 'RoyalTitle', serif;
    font-size: 1.2rem;
}
        /* [수정] 설명글 스타일: 왼쪽 정렬하되 제목(b태그)은 가운데로 */
        #r-desc {
            line-height: 1.6; 
            word-break: keep-all; 
            font-size: 0.95rem;
            
            /* [핵심] 여기가 justify로 바뀌어야 양쪽 정렬이 됩니다! */
            text-align: justify; 
            
            padding: 0 10px;
        }
        
        /* b태그(제목)는 블록으로 만들어서 가운데 정렬 */
        #r-desc b {
            display: block;
            text-align: center;
            margin-top: 15px;
            margin-bottom: 5px;
            color: var(--main-gold);
            font-size: 1.05rem;
        }

        #name-input {
    background: var(--glass-bg); /* 어두운 반투명 배경 */
    border: 2px solid var(--sub-gold); /* 금색 테두리 */
    box-shadow: 
        0 0 15px rgba(197, 160, 89, 0.2), /* 금색 은은한 광 */
        inset 0 0 20px rgba(0,0,0,0.5); /* 안쪽 그림자 */
    border-radius: 5px; /* 둥근 모서리보다는 살짝 각진 게 더 클래식함 */
    padding: 30px 20px;
    position: relative;
}

        #name-input::after {
    content: "❖"; /* 마름모 문양 */
    position: absolute;
    top: -14px; left: 50%; transform: translateX(-50%);
    background: var(--bg-color);
    padding: 0 10px;
    color: var(--sub-gold);
    font-size: 1.2rem;
}
       
        .share-btn { 
            background: #1DA1F2; color: white; border: none; padding: 15px 30px; 
            border-radius: 30px; cursor: pointer; font-size: 1rem; margin: 5px; 
            font-family: 'RoyalTitle', serif; 
            box-shadow: 0 5px 15px rgba(29, 161, 242, 0.4); transition: transform 0.2s;
        }
        .share-btn:hover { transform: scale(1.05); }
        
        .music-control { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; z-index: 200; }

        /* 편지 봉투 & 모달 스타일 */
        .envelope-area {
            width: 100%; max-width: 300px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px; padding: 15px; margin: 10px auto 20px auto;
            cursor: pointer; transition: transform 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .envelope-area:hover { transform: scale(1.02); background: rgba(255, 255, 255, 0.1); }
        
        .envelope-icon {
            width: 40px; height: 30px; background: #e0d0a0;
            position: relative; border-radius: 3px;
            display: flex; align-items: center; justify-content: center;
        }
        .envelope-icon::before {
            content: ''; position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 20px solid transparent; border-right: 20px solid transparent;
            border-top: 15px solid #c9b57c;
        }
        .wax-seal {
            width: 16px; height: 16px; border-radius: 50%;
            background: #d62828; box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
            z-index: 2; border: 2px solid rgba(255,255,255,0.2);
        }

        #letter-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 9999;
            align-items: center; justify-content: center; padding: 20px;
        }
        #letter-modal.open { display: flex; animation: fadeIn 0.5s; }
        
        .letter-paper {
    background: var(--glass-bg); /* 어두운 반투명 배경 */
    border: 2px solid var(--sub-gold); /* 금색 테두리 */
    box-shadow: 
        0 0 15px rgba(197, 160, 89, 0.2), /* 금색 은은한 광 */
        inset 0 0 20px rgba(0,0,0,0.5); /* 안쪽 그림자 */
    border-radius: 5px; /* 둥근 모서리보다는 살짝 각진 게 더 클래식함 */
    padding: 30px 20px;
    position: relative;
}
        .close-btn {
            position: absolute; top: 10px; right: 15px;
            font-size: 24px; cursor: pointer; color: #888;
        }

        /* --- [NEW] 크레딧(Credit) 버튼 & 모달 스타일 --- */
        .credit-btn {
            background: transparent;
            color: rgba(255, 255, 255, 0.6); /* 살짝 투명한 흰색 */
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 20px;
            cursor: pointer;
            font-family: 'Pretendard', sans-serif;
            transition: all 0.3s;
        }
        .credit-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-color: #fff;
        }

        /* 크레딧 팝업창 (기존 편지 모달 스타일 재활용) */
        #credit-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 10000; /* 편지보다 더 위에 */
            align-items: center; justify-content: center; padding: 20px;
        }
        #credit-modal.open { display: flex; animation: fadeIn 0.5s; }

        .credit-content {
            background: #1a1a1a; /* 어두운 배경 */
            color: #f1e5ac; /* 금색 글씨 */
            border: 1px solid #bfae76;
            width: 100%; max-width: 350px;
            padding: 30px 20px; border-radius: 10px;
            text-align: center;
            font-family: 'CleanBody', serif;
            line-height: 2;
            font-size: 0.95rem;
            position: relative;
        }
        .credit-content h3 {
            font-family: 'RoyalTitle', serif;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        /* [NEW] 로딩 멘트 스타일 (질문지 폰트 효과 적용) */
        #loading-text {
            font-family: 'CleanBody', serif; 
            font-size: 1.3rem; /* 글자 크기 살짝 키움 */
            font-weight: bold;
            margin-top: 30px;
            
            /* 질문지와 동일한 금색 효과 */
            background: linear-gradient(to bottom, #fff 0%, #f1e5ac 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
    </style>
</head>
<body>
    <audio id="bgm" loop preload="auto"><source src="romancebgm.mp3" type="audio/mp3"></audio>
    <audio id="sfx-horse" preload="auto"><source src="./sounds/horse.mp3" type="audio/mp3"></audio>
    <audio id="sfx-chime" preload="auto"><source src="./sounds/chime.mp3" type="audio/mp3"></audio>
    <audio id="sfx-page" preload="auto"><source src="./sounds/page.mp3" type="audio/mp3"></audio>
    <audio id="sfx-mystic" preload="auto"><source src="./sounds/mystic.mp3" type="audio/mp3"></audio>
    <audio id="sfx-result" preload="auto"><source src="./sounds/tada.mp3" type="audio/mp3"></audio>

    <div class="container">
        <div class="music-control" onclick="toggleMusic()">🔊</div>

        <img src="./images/logo.png" alt="타이틀 로고" id="main-logo">

        <section id="intro" class="active">
            <img src="./images/invitationcard.jpg" alt="NCT WISH 초대장" class="intro-img" onclick="triggerLogoAnimation()">
            <button class="btn-gold" onclick="triggerLogoAnimation()">초대장 열기</button>
        </section>

        <section id="name-input" class="fade-in content-with-logo">
            <h2 style="margin-bottom: 30px; font-weight: normal; font-family:'RoyalTitle', serif;">입장하시겠습니까?</h2>
            <p>초대장에 적힌 이름을 알려주세요.</p>
            <input type="text" id="username" placeholder="즈니" maxlength="5">
            <p style="font-size: 0.9rem; opacity: 0.7;">공주님</p>
            <button class="btn-gold" onclick="playSfx('sfx-chime'); startGame();">입장하기</button>
        </section>

        <section id="game" class="fade-in content-with-logo">
            <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
            <div class="question-text" id="q-text">질문</div>
            <div id="choices-area"></div>
        </section>

        <section id="loading" class="fade-in content-with-logo">
            <div style="font-size: 3rem; animation: float 1s infinite;">🔮</div>
            <p id="loading-text" style="margin-top: 20px; font-size: 1.1rem;">별들이 운명을 점치고 있습니다...</p>
        </section>

        <section id="result" class="fade-in content-with-logo">
            <div class="result-card">
                <div class="result-title" id="r-title"></div>
                <div class="result-name" id="r-name"></div>
                <img src="" id="r-img" class="result-img">
                <div class="result-quote" id="r-quote"></div>
                <div style="line-height: 1.6; word-break: keep-all; font-size: 0.95rem;" id="r-desc"></div>
            </div>

            <div class="envelope-area" onclick="openLetter()">
                <div class="envelope-icon">
                    <div class="wax-seal" id="wax-seal"></div>
                </div>
                <p style="font-family:'RoyalTitle', serif; font-size:1.1rem;">후일담</p>
            </div>

            <button class="share-btn" onclick="shareTwitter()">💌 약혼 발표하기</button>
            <button class="btn-gold" onclick="location.reload()" style="margin-top: 10px; font-size: 0.9rem; padding: 10px 20px;">🔄 다시하기</button>
            
            <button class="credit-btn" onclick="openCredit()">Credit</button>
        </section>
    </div>

    <div id="letter-modal">
        <div class="letter-paper">
            <span class="close-btn" onclick="closeLetter()">×</span>
            <div id="letter-content"></div>
        </div>
    </div>

    <div id="credit-modal">
        <div class="credit-content">
            <span class="close-btn" onclick="closeCredit()">×</span>
            <h3>Credit</h3>
            <p>
                <b>기획/제작</b><br>인스타 @jpn.boys / X @3hstellah3<br><br>
                <b>BGM</b><br>Enya Style - Romantic Fantasy Waltz<br><br>
                <b>디자인 소스</b><br>X @sido_k7<br><br>
                <b>제복 이미지</b><br>nano banana pro
            </p>
        </div>
    </div>

    <script>
        // --- 데이터 ---
        const questions = [
            { q: "Q1. 연회장에 들어선 순간, 눈이 마주친 사람은?", a: [
                { text: "사람들에게 둘러싸여 웃고 있지만 시선은 오직 나를 향해 고정된 남자", target: "sakuya" },
                { text: "나와 눈이 마주치자 황급히 시선을 피해버리는 왕자", target: "riku" },
                { text: "제복을 단정하게 차려입고 마중 나와 에스코트를 기다리는 왕자", target: "jaehee" },
                { text: "상석에서 지루한 듯 턱을 괴고 아래를 내려보다가 나를 발견하곤 씩 웃는 왕자", target: "sion" },
                { text: "샹들리에를 유심히 관찰하다가 나를 보자 수줍게 웃는 왕자", target: "ryo" },
                { text: "아무도 없는 테라스 그늘, 집요하게 나만 쳐다보고 있는 묘한 분위기의 왕자", target: "yushi" }
            ]},
            { q: "Q2. 가면무도회의 시작, 당신이 고른 가면은?", a: [
                { text: "화려한 깃털 가면", target: "sion" },
                { text: "단정한 은색 가면", target: "jaehee" },
                { text: "얼굴 절반을 가리는 신비로운 가면", target: "yushi" },
                { text: "차가운 얼음 가면", target: "riku" },
                { text: "눈만 겨우 가리는 심플한 가면", target: "ryo" },
                { text: "귀여운 동물 가면", target: "sakuya" }
            ]},
            { q: "Q3. 웰컴 드링크가 제공됩니다. 당신의 선택은?", a: [
                { text: "붉은 장미 향이 나는 최고급 와인", target: "sion" },
                { text: "깔끔하고 청량한 과일 주스", target: "jaehee" },
                { text: "보라색 오로라가 일렁이는 정체불명의 칵테일", target: "yushi" },
                { text: "독해 보이지만 얼음이 가득 든 위스키 온 더 락", target: "riku" },
                { text: "마음을 차분하게 진정시켜 주는 따뜻한 홍차", target: "ryo" },
                { text: "톡톡 터지는 캔디가 들어간 에이드", target: "sakuya" }
            ]},
            { q: "Q4. 무도회가 시작되고 첫 번째 춤 신청을 받았습니다. 그가 건넨 말은?", a: [
                { text: "“공주님, 저와 춤추는 영광을 드려도 될까요? 거절은 곤란해요.”", target: "sion" },
                { text: "“오래 기다렸습니다. 제 검을 걸고 맹세컨대 가장 완벽한 춤을 선사하겠습니다.”", target: "jaehee" },
                { text: "말없이 쑥 내밀어진 손. 그의 손끝에서 파란 불꽃이 일렁이다 꽃으로 변한다.", target: "yushi" },
                { text: "“...사람들이 수군댈 지도 몰라. 그래도 혹시 괜찮다면, 나와 춤춰 주겠어?”", target: "riku" },
                { text: "“저... 혹시 발 밟아도 화 안 내실 거죠? 연습 많이 하긴 했는데...”", target: "ryo" },
                { text: "“제가 여기서 제일 잘 춰요. 그리고 공주님은 여기서 가장 아름답고요!”", target: "sakuya" }
            ]},
            { q: "Q5. 춤을 추던 도중 실수로 그의 발을 밟아버렸습니다! 그의 반응은?", a: [
                { text: "“일부러 그런 거지? 나한테 안기려고.” 능청스럽게 넘기며 귓가에 속삭인다.", target: "sion" },
                { text: "“괜찮아? 안 다쳤어? 혹시 구두가 불편해?”", target: "jaehee" },
                { text: "(발을 빤히 보며) “...밟힌 느낌이 나쁘지 않아. 한 번 더 밟아줘.”", target: "yushi" },
                { text: "...난 괜찮아. 진짜 안 아파. 이 정도는 느낌도 안 나.”", target: "riku" },
                { text: "“어? 어어?!” 같이 당황해서 멈칫거리다 박자를 완전히 놓쳐버린다.", target: "ryo" },
                { text: "본인이 일부러 더 크게 스텝을 엉키게 만들어 사람들의 웃음을 자신에게 돌린다.", target: "sakuya" }
            ]},
            { q: "Q6. 발코니에서 바람을 쐬는데 그가 따라왔습니다. 무슨 이야기를 할까요?", a: [
                { text: "“안이 답답한가? 원한다면 이 성을 지금 당장 텅 비게 만들어 줄 수도 있는데.”", target: "sion" },
                { text: "“겉옷 가져왔어. 밤바람이 차.”", target: "jaehee" },
                { text: "“달이 예쁘네. ...가지고 싶어? 따다 줄까?”", target: "yushi" },
                { text: "“혼자 있으면 위험할까 봐... 방해된다면 저쪽에 가 있을게.”", target: "riku" },
                { text: "“저 별자리는 말이죠... 아, 죄송해요. 제가 또 지루한 얘기를...”", target: "ryo" },
                { text: "“여기서 보니까 성이 장난감 같네- 우리 저기 담장 넘어서 도망갈까요?”", target: "sakuya" }
            ]},
            { q: "Q7. 연회장에 불청객이 난입해 소란이 일어났습니다. 불청객이 당신에게 다가오려하자, 그의 행동은?", a: [
                { text: "귀찮다는 듯 하품을 하며 근위병들에게 눈짓 한 번으로 제압을 명령한다.", target: "sion" },
                { text: "순식간에 검을 뽑아 불청객의 목을 겨눈다. “물러가십시오. 제가 베지 못하는 것은 없습니다.”", target: "jaehee" },
                { text: "손가락을 튕기자 불청객이 무언가에 부딪힌 듯 뒤로 밀려난다. “거슬려. 없애버릴까?”", target: "yushi" },
                { text: "살벌한 눈빛으로 불청객을 노려보며 나의 손을 꽉 잡고 다른 손으로 검 손잡이를 꽉 쥔다.", target: "riku" },
                { text: "상황을 빠르게 파악하고 비상구를 찾아 나를 안전한 곳으로 이끈다.", target: "ryo" },
                { text: "“무서워요?” 라며 내 손을 잡고, 혼란을 틈타 둘만의 장소로 도망친다.", target: "sakuya" }
            ]},
            { q: "Q8. 소란이 진정되고 그가 당신에게 건넨 간식은 무엇일까요?", a: [
                { text: "금가루가 뿌려진 디저트", target: "sion" },
                { text: "따뜻하게 데운 우유와 부드러운 카스텔라", target: "jaehee" },
                { text: "입안에서 톡톡 터지는 보라색 별사탕", target: "yushi" },
                { text: "달콤한 초콜릿 한 조각", target: "riku" },
                { text: "견과류와 허브티", target: "ryo" },
                { text: "난생 처음 보는 별 모양의 과일", target: "sakuya" }
            ]},
            { q: "Q9. 답답해진 당신은 몰래 정원으로 빠져나왔습니다. 그곳에서 마주친 그는 무엇을 하고 있었나요?", a: [
                { text: "지루하다는 표정으로 동전을 던지고 있다가 나를 보고 웃는다.", target: "sion" },
                { text: "내가 나올 문만 하염없이 바라보고 있었다.", target: "jaehee" },
                { text: "허공에 떠다니는 빛나는 나비들과 대화하고 있다.", target: "yushi" },
                { text: "덤불 속에 숨어있던 고양이에게 “야옹...” 하고 말을 걸다가 나에게 들켰다.", target: "riku" },
                { text: "달빛 아래서 나에게 할 말을 수첩에 적으며 연습하고 있었다.", target: "ryo" },
                { text: "쭈그려앉아 꽃반지를 만들고 있다가 내 손에 끼워준다.", target: "sakuya" }
            ]},
            { q: "Q10. 단둘만 남은 정원, 당신이 그에게 묻습니다. “만약 우리가 함께 떠날 수 있다면, 어디로 가고 싶어?”", a: [
                { text: "“어디든 상관없어. 어차피 이 대륙의 끝까지 다 내 땅이니까. 고르기만 해.”", target: "sion" },
                { text: "“네가 원하는 곳이라면 어디든 따라갈게.”", target: "jaehee" },
                { text: "“시간이 멈춘 차원의 틈새. 거기선 영원히 우리 둘만 있을 수 있어.”", target: "yushi" },
                { text: "“...우리 집. 춥긴 한데 내가 껴안고 있으면 되잖아. 내 성에는 예쁜 눈토끼도 많아.”", target: "riku" },
                { text: "“아무도 모르는 조용한 도서관이나... 별이 잘 보이는 언덕이요.”", target: "ryo" },
                { text: "“음~ 우리 둘만 아는 비밀 화원? 거기서 매일 소꿉놀이하고 싶어요.”", target: "sakuya" }
            ]},
            { q: "Q11. 그가 문득 당신에게 솔직한 마음 한 조각을 털어놓습니다.", a: [
                { text: "“사실 황위 같은 거 관심 없어. 내가 원하는 건 너야.”", target: "sion" },
                { text: "“손에 굳은살이 박여서... 네 손을 잡을 때 아플까 봐 걱정돼.”", target: "jaehee" },
                { text: "“마법보다 네 목소리가 더 신기해. 계속 듣고 싶어서 잠을 못 자겠어.”", target: "yushi" },
                { text: "“다들 날 무서워해. 너도... 내가 무서워? 너만큼은 그러지 않았으면 좋겠어...”", target: "riku" },
                { text: "“저는 다른 사람들처럼 강하지도, 싸움을 잘하지도 못해요. 하지만... 당신을 행복하게 만들 계획은 수만 가지예요.”", target: "ryo" },
                { text: "“저 공주님한테 첫눈에 반했어요. 공주님도 날 좋아해주면 안 돼요?”", target: "sakuya" }
            ]},
            { q: "Q12. 자정이 다가옵니다. 이제 집으로 돌아가야 할 시간, 그의 반응은?", a: [
                { text: "문을 가로막고 선다. “보내주기 싫은데. 황명으로 가지 말라 해버릴까.”", target: "sion" },
                { text: "아쉬운 표정으로 “혹시 내일 아침에... 만나러 가도 될까?”", target: "jaehee" },
                { text: "허공에 손을 긋는다. “시간을 멈추는 마법을 썼어. 이러면 오늘 밤은 영원해.”", target: "yushi" },
                { text: "손을 잡으려다 멈칫하며 “...조심히 가. 마차가 성문을 나갈 때까지 보고 있을게.", target: "riku" },
                { text: "“조심히 가세요. 오늘 하루... 평생 잊지 못할 거예요.”", target: "ryo" },
                { text: "내 팔에 매달리며 “나도 갈래! 같이 가요!”", target: "sakuya" }
            ]},
            { q: "Q13. 그가 당신에게 마지막으로 주고 싶은 선물이 있다고 합니다. 무엇일까요?", a: [
                { text: "제국 황실 문장이 새겨진 화려한 반지", target: "sion" },
                { text: "자신의 검에 달려있던 수호의 펜던트", target: "jaehee" },
                { text: "위험할 때 부르면 소환되는 마력석 목걸이", target: "yushi" },
                { text: "추위를 막아줄 하얗고 두꺼운 망토", target: "riku" },
                { text: "단정한 글씨로 직접 필사한 시집", target: "ryo" },
                { text: "반으로 쪼개진 하트 모양 목걸이", target: "sakuya" }
            ]},
            { q: "Q14. 당신이 꿈꾸는 사랑은 무엇인가요?", a: [
                { text: "나를 리드해주고 언제나 새로운 설렘과 긴장감을 주는 사랑", target: "sion" },
                { text: "친구처럼 편안하고 서로를 가장 잘 아는 따뜻한 사랑", target: "jaehee" },
                { text: "말하지 않아도 통하는 신비롭고 운명적인 사랑", target: "yushi" },
                { text: "표현이 서툴지만 나만 바라보는 귀여운 사랑", target: "riku" },
                { text: "서로의 지혜를 나누며 함께 성장하는 헌신적인 사랑", target: "ryo" },
                { text: "매일매일이 축제처럼 즐겁고 웃음이 끊이지 않는 사랑", target: "sakuya" }
            ]},
            { q: "Q15. 그가 무릎을 꿇고 당신에게 청혼합니다.", a: [
                { text: "“이 제국의 모든 영광을 그대의 발아래 바치지. 그러니 그대는 나를 다스려줘.”", target: "sion" },
                { text: "“왕관 같은 건 필요 없습니다. 평생 당신만의 기사로 살고싶습니다.”", target: "jaehee" },
                { text: "“이제 너 없는 영원은 나에게 지옥이야. 날 지옥으로 보낼 거야?”", target: "yushi" },
                { text: "“북부는 춥고 척박해. 당신이 살기엔 힘들지도 몰라. 하지만... 약속할게. 평생 손끝 하나 시렵게 안 하겠다고.”", target: "riku" },
                { text: "“저, 저는 아직 부족한 게 많지만... 공주님을 행복하게 만드는 건 누구보다 자신 있어요! 저랑... 결혼해 주실래요?”", target: "ryo" },
                { text: "“낙원의 과일을 훔쳐먹으면 다시는 밖으로 못 나가요. 제 마음을 훔쳤으니까 이제 공주님은 평생 제 거예요.”", target: "sakuya" }
            ]}
        ];

        const results = {
            sion: { 
                title: "제국의 황태자", name: "아뜰리에(시온)", quote: "당신을를 비추는 제국의 태양", desc: "<b>[운명의 서사]</b><br>모두가 그의 권력 앞에 고개를 숙이지만 그는 사실 황위에 관심이 없습니다. 오직 당신에게만 흥미를 느끼고 있죠. 다른 영애들에게는 차갑게 굴지만 당신에게만 능글맞은 장난을 치며 반응을 즐깁니다.<br><br><b>[{name}(와)과의 궁합]</b><br>당신(은)는 그의 짓궂은 장난을 유일하게 받아칠 수 있는 강단 있는 사람입니다. 아뜰리에 왕자는 자신을 어려워하지 않고 있는 그대로 봐주는 당신에게서 진정한 안식처를 느낍니다. 지루한 황실 생활 속 당신(은)는 그에게 유일한 자극이자 사랑입니다.", img: "sion.png",
                color: "#c79ee5",
                epilogue: "연회가 끝나고 모두가 떠난 텅 빈 홀.<br><br>그는 옥좌에 비스듬히 앉아 {name}(을)를 무릎 위에 앉혔습니다. 그의 손가락이 머리카락을 부드럽게 감습니다.<br><br>“이제 도망갈 생각은 마. 이 제국의 태양이 지지 않는 한, 너는 내 곁에 있어야 하니까.”<br><br>그가 장난스럽게 웃으며 {name}의 손등에 입을 맞춥니다. 가장 화려하고 가장 절대적인 사랑이 시작되었습니다."
            },
            jaehee: { 
                title: "기사국의 왕자", name: "포스(재희)", quote: "당신만을 위해 검을 드는 기사", desc: "[운명의 서사]</b><br>어릴 적부터 당신의 곁을 지켜온 소꿉친구. 왕위 계승권보다 당신의 안위를 더 중요하게 생각합니다. 당신이 힘들 때면 말없이 다가와 따뜻한 코코아를 건네주는 다정함의 의인화. 하지만 누군가 당신을 위협하면 가장 무서운 검귀로 돌변합니다.<br><br><b>[{name}(와)과의 궁합]</b><br>불안한 사랑보다는 신뢰와 안정을 추구하는 당신에게 딱 맞는 운명입니다. 당신이 어디서 무엇을 하든, 뒤를 돌아보면 항상 그가 든든하게 서 있을 것입니다. 친구에서 연인으로 발전하는 가장 완벽한 서사의 주인공이 되세요.", img: "jaehee.png",
                color: "#a4e87c",
                epilogue: "“정말... 정말 나라도 괜찮은 거야?”<br><br>그는 믿기지 않는다는 듯 떨리는 손으로 당신의 손끝에 입을 맞췄습니다. 그리고 그는 자신의 검을 풀어 당신에게 건네며 무릎을 꿇습니다. 굳은살 박인 손이 조심스럽게 당신의 손을 감쌉니다.<br><br>“맹세합니다. 제 심장이 뛰는 마지막 순간까지, 당신의 앞을 막는 모든 슬픔을 이 검으로 베어내겠습니다.”<br><br>그의 눈동자는 흔들림 없이 오직 당신만을 담고 있습니다."
            },
            yushi: { 
                title: "마법국의 왕자", name: "다비(유우시)", quote: "금기를 속삭이는 마탑의 주인", desc: "<b>[운명의 서사]</b><br>강력한 마력을 타고나 마탑에 갇혀 지낸 고독한 왕자. 세상 만사에 무관심하고 4차원처럼 보이지만 우연히 마주친 당신에게 강렬한 무언가을 느꼈습니다. 사람들과 교류해본 적이 없어 가끔 엉뚱한 행동을 하며, 겉은 잔잔해보여도 마음 속에는 당신을 향한 거대한 소유욕이 끓고 있습니다.<br><br><b>[{name}(와)과의 궁합]</b><br>신비롭고 독특한 매력에 끌리는 당신! 다비 왕자의 닫힌 마음을 열 수 있는 열쇠는 오직 당신뿐입니다. 조용하지만 그 누구보다 뜨거운, 서로에게만 집중하는 깊고 진득한 사랑을 하게 될 운명입니다.", img: "yushi.png",
                color: "#9ed9e5",
                epilogue: "그가 손을 휘젓자 주변의 풍경이 순식간에 바뀌었습니다.<br><br>아무도 없는, 별이 쏟아지는 밤하늘 아래의 몽환적인 정원. 그는 만족스러운 듯 희미하게 미소 지으며 {name}(을)를 바라봅니다.<br><br>“이제 아무도 우릴 방해 못 해. 시간도 세상도 다 멈췄어. 오직 너와 나뿐이야.”<br><br>그의 사랑은 영원히 풀리지 않는 마법처럼 {name}(을)를 감쌉니다."
            },
            riku: { 
                title: "북부의 왕자", name: "라일(리쿠)", quote: "겨울을 지배하는 설원의 늑대", desc: "<b>[운명의 서사]</b><br>피도 눈물도 없다는 소문의 주인공인 왕자. 하지만 사실은 낯을 많이 가리고 부끄러움이 많을 뿐입니다. 당신을 좋아하지만 악명 높은 자신과 엮이면 당신까지 곤란해질까 봐 일부러 차갑게 피하고 있습니다. 당신이 '날 싫어하나?'라고 오해하고 돌아설 때 그 뒷모습을 보며 슬픈 표정을 짓고 있을 겁니다..<br><br><b>[{name}(와)과의 궁합]</b><br>차가운 표정 뒤에 숨겨진 진심과 배려를 알아채는 섬세한 당신! 라일 왕자는 사실 당신의 작은 호의에도 세상을 다 가진 듯 감동할, 알고 보면 여리고 외로운 늑대 소년입니다. <br>당신의 따뜻함으로 꽁꽁 언 그의 세상을 녹여줄 수 있을 겁니다.", img: "riku.png",
                color: "#ed8686",
                epilogue: "북부로 향하는 마차 안. 그는 {name}(이)가 북부의 추위에 적응하지 못할까 걱정하느라 여념이 없습니다.<br><br>“벌써 추워? 아직 도착도 안 했는데... 담요 여기 있어. 아니면... 내 손 따뜻해.”<br><br>그는 {name}(이)가 고맙다고 웃으며 손을 잡자 귀까지 빨개져서 고개를 홱 돌려버립니다. 맞닿은 손바닥이 불에 덴 듯 뜨겁습니다.<br><br>“...너무 걱정 마. 내 심장이 식기 전까진... 그 어떤 눈보라도 네 옷깃 하나 스치지 못하게 할 테니까.”"
            },
            ryo: { 
                title: "학술국의 왕자", name: "치치(료)", quote: "별을 읽는 지혜의 등불", desc: "<b>[운명의 서사]</b><br>무력보다는 명석한 두뇌로 나라를 이끄는 왕자. <br>완벽주의자 성향이지만 짝사랑하는 당신 앞에서는 안경을 떨어뜨리고 말을 더듬는 허당기를 보입니다. 당신이 빛날 수 있도록 뒤에서 모든 판을 설계하고 지원하는 헌신적인 사랑꾼입니다.<br><br><b>[{name}(와)과의 궁합]</b><br>배울 점이 있는 사람을 좋아하는 당신에게 치치 왕자는 최고의 파트너입니다. 서로의 부족한 점을 채워주며 함께 성장하는 건강한 관계! 그가 쓴 수천 장의 연애편지를 받을 준비가 되셨나요?", img: "ryo.png",
                color: "#fdf980",
                epilogue: "그는 서재 한가득 쌓인 책들을 뒤로하고 계획표를 펼쳐 보입니다.<br><br>“이건 신혼여행 계획이고요, 이건 우리가 살 집 설계도예요. 그리고 이건...”<br><br>그는 수줍게 안경을 고쳐 쓰며 {name}의 눈치를 살핍니다.<br><br>“아... 너무 앞서갔나요? 죄송해요. 하지만... {name}(와)과 함께할 미래를 상상하면 저도 모르게 멈출 수가 없어서요.”"
            },
            sakuya: { 
                title: "요정국의 왕자", name: "베티(사쿠야)", quote: "사랑을 노래하는 낙원의 정령", desc: "<b>[운명의 서사]</b><br>존재 자체가 사랑스러운 왕자. <br>복잡한 황실의 격식 따위는 중요하지 않습니다. “네가 좋으면 다 좋아!'라는 마인드로 직진하는 패기 넘치는 남자입니다. 당신이 우울할 틈을 주지 않고 매일매일 달콤한 디저트와 웃음을 선물할 것입니다.<br><br><b>[{name}(와)과의 궁합]</b><br>함께 있으면 즐겁고 에너지가 넘치는 연애를 꿈꾸는 당신! <br>계산적이지 않고 투명한 베티 왕자의 사랑이 당신의 삶을 동화처럼 만들어줄 것입니다. 귀여운 얼굴 뒤에 숨겨진 의외의 박력을 기대해 보세요.", img: "sakuya.png",
                color: "#f6a1d0",
                epilogue: "그는 당신의 손을 잡고 낙원의 꽃밭을 뛰어다닙니다.<br><br>“이것 봐요! 나비들도 우리 축하해주러 왔나 봐!”<br><br>그는 세상에서 가장 환한 미소로 {name}(을)를 와락 껴안습니다.<br><br>“약속할게요. 매일매일 사랑한다고 말해주고 웃게 해줄게요. 나랑 있을 때 세상에서 제일 행복할 걸요?”"
            }
        };

        let currentQ = 0;
        let scores = { sion: 0, jaehee: 0, yushi: 0, riku: 0, ryo: 0, sakuya: 0 };
        let username = "즈니";
        let currentResultData = null; // [수정] 후일담 데이터를 저장할 전역 변수

        function showSection(id) {
            document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
            const target = document.getElementById(id);
            if(target) target.classList.add('active');
        }

        function toggleMusic() {
            const bgm = document.getElementById('bgm');
            if(bgm.paused) { bgm.play(); document.querySelector('.music-control').innerText = '🔊'; }
            else { bgm.pause(); document.querySelector('.music-control').innerText = '🔇'; }
        }

        function playSfx(id) {
            const audio = document.getElementById(id);
            if(audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log("효과음 재생 차단됨"));
            }
        }

        function triggerLogoAnimation() {
            playSfx('sfx-horse');
            document.getElementById('bgm').play().catch(e => console.log("자동재생 차단됨"));
            
            document.getElementById('intro').classList.remove('active');

            const logo = document.getElementById('main-logo');
            logo.classList.add('center');

            setTimeout(() => {
                logo.classList.remove('center');
                logo.classList.add('top');
                
                showSection('name-input');
            }, 1500);
        }

        function startGame() {
            const inputName = document.getElementById('username').value;
            if(inputName) username = inputName;
            currentQ = 0;
            renderQuestion();
            showSection('game');
        }

        /* --- [1] 배열을 랜덤으로 섞어주는 마법의 함수 (새로 추가!) --- */
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]]; // 요소 위치 교환
        }
        return array;
    }

    function renderQuestion() {
            const q = questions[currentQ];
            // [수정] 질문에 이름 적용
            document.getElementById('q-text').innerHTML = resolveKorean(q.q, username);
            document.getElementById('progress').style.width = ((currentQ / questions.length) * 100) + '%';
            
            const area = document.getElementById('choices-area');
            area.innerHTML = '';
            
            const shuffledAnswers = shuffleArray([...q.a]);
            
            shuffledAnswers.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                // [수정] 선택지에 이름 적용
                btn.innerText = resolveKorean(choice.text, username);
                
                btn.onclick = () => {
                    playSfx('sfx-page'); 
                    scores[choice.target]++;
                    nextQuestion();
                };
                area.appendChild(btn);
            });
        }

        function nextQuestion() {
            if (currentQ < questions.length - 1) {
                currentQ++;
                renderQuestion();
            } else {
                showLoading();
            }
        }

        const loadingMessages = [
            "별들이 운명을 점치고 있습니다...",
            "아뜰리에가 황실 문서를 검토 중입니다...",
            "다비가 시간 멈추는 마법을 연습 중입니다...",
            "앗, 베티가 케이크를 다 먹어버렸습니다!",
            "포스가 무릎 끓고 검을 쥔 채 기도를 올립니다...",
            "라일이 {name}(을)를 힐끔힐끔 바라봅니다...",
            "치치가 {name}(와)과의 미래를 설계 중입니다..."
        ];

        function showLoading() {
            showSection('loading');
            playSfx('sfx-mystic');
            
            const textEl = document.getElementById('loading-text');
            let i = 0;
            const interval = setInterval(() => {
                // [수정] 로딩 멘트에 이름 적용
                textEl.innerHTML = resolveKorean(loadingMessages[i % loadingMessages.length], username);
                i++;
            }, 1100);

            setTimeout(() => {
                clearInterval(interval);
                showResult();
            }, 12000);
        }

        // [수정] 한글 조사 자동 변환 함수
        function resolveKorean(text, name) {
            let result = text.replace(/{name}/g, name);
            const lastChar = name.charCodeAt(name.length - 1);
            const hasBatchim = (lastChar - 44032) % 28 > 0;

            result = result.replace(/\(이\)가/g, hasBatchim ? '이' : '가');
            result = result.replace(/\(은\)는/g, hasBatchim ? '은' : '는');
            result = result.replace(/\(을\)를/g, hasBatchim ? '을' : '를');
            result = result.replace(/\(와\)과/g, hasBatchim ? '과' : '와');
            result = result.replace(/\(이\)여/g, hasBatchim ? '이어' : '여'); 

            return result;
        }
        
        function showResult() {
            let maxScore = -1;
            let resultKey = "sion";
            for (let key in scores) {
                if (scores[key] > maxScore) {
                    maxScore = scores[key];
                    resultKey = key;
                }
            }

            const data = results[resultKey];
            // [수정] 전역 변수에 데이터 할당 (이게 없어서 후일담이 안 열렸음)
            currentResultData = data;
            
            document.getElementById('r-title').innerText = data.title;
            // [수정] 이름 적용
            document.getElementById('r-name').innerHTML = resolveKorean(data.name, username);
            // [수정] 명대사 적용 (이름 변환)
            document.getElementById('r-quote').innerHTML = `"${resolveKorean(data.quote, username)}"`;
            // [수정] 본문 적용 (이름 변환)
            document.getElementById('r-desc').innerHTML = resolveKorean(data.desc, username);
            
            document.getElementById('r-img').src = "./images/" + data.img; 

            playSfx('sfx-result');
            showSection('result');
        }

        function openLetter() {
            playSfx('sfx-page'); 
            const modal = document.getElementById('letter-modal');
            const content = document.getElementById('letter-content');
            
            // [수정] 전역 변수에서 후일담 내용 가져오기 + 이름 변환 적용
            content.innerHTML = resolveKorean(currentResultData.epilogue, username); 
            modal.classList.add('open'); // CSS class 사용
            modal.style.display = "flex"; 
        }

        function closeLetter() {
            document.getElementById('letter-modal').style.display = "none";
        }

        function shareTwitter() {
            const rName = document.getElementById('r-name').innerText;
            const text = `[운명의 왕자님 찾기]\n나의 정혼자는 '${rName}'입니다!\n공주님도 당신의 왕자님을 찾아보세요 👑\n#NCTWISH #엔시티위시 #팬미팅 #테스트`;
            const url = window.location.href;
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`);
        }

        // [NEW] 크레딧 모달 열기/닫기 함수
        function openCredit() {
            document.getElementById('credit-modal').classList.add('open');
        }

        function closeCredit() {
            document.getElementById('credit-modal').classList.remove('open');
        }

        document.addEventListener('mousemove', function(e) {
            const sparkle = document.createElement('div');
            sparkle.classList.add('sparkle');
            sparkle.style.left = e.pageX + 'px';
            sparkle.style.top = e.pageY + 'px';
            const size = Math.random() * 4 + 2; 
            sparkle.style.width = size + 'px';
            sparkle.style.height = size + 'px';
            document.body.appendChild(sparkle);
            setTimeout(() => {
                sparkle.remove();
            }, 1000);
        });
    </script>
</body>
</html>







